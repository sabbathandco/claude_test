<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Underwatermelon â€“ Fruit Merge</title>

<style>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ GENERAL RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*{margin:0;padding:0;box-sizing:border-box;user-select:none;-webkit-user-select:none;-webkit-touch-callout:none}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ GLOBAL / BODY â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body{
    font-family:'Trebuchet MS','Arial Rounded MT Bold','Comic Sans MS',cursive,sans-serif;
    background:linear-gradient(180deg,#4A90E2 0%,#2E5C8A 50%,#1A3A5C 100%);
    overflow:hidden;touch-action:none;height:100vh;width:100vw;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ MAIN CONTAINER â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#gameContainer{
    position:relative;width:100vw;height:100vh;
    background:
        radial-gradient(circle at 20% 80%,rgba(72,209,204,.30) 0%,transparent 50%),
        radial-gradient(circle at 80% 20%,rgba(135,206,235,.30) 0%,transparent 50%),
        linear-gradient(180deg,#4A90E2 0%,#2E5C8A 30%,#1E4A6B 70%,#0F2A3D 100%);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ MENU â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#menu{
    position:absolute;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;
    background:linear-gradient(45deg,#20B2AA,#4682B4);z-index:1000;
}
#title{
    font-size:1.8rem;color:#FFD700;text-shadow:3px 3px 6px rgba(0,0,0,.5);
    margin-bottom:2rem;text-align:center;animation:float 3s ease-in-out infinite;padding:0 20px;
}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.menu-btn{
    background:linear-gradient(45deg,#32CD32,#228B22);border:none;color:#fff;padding:15px 30px;
    font-size:1.1rem;border-radius:25px;margin:8px;cursor:pointer;font-weight:bold;min-width:200px;
    box-shadow:0 4px 15px rgba(0,0,0,.3);transition:all .3s;
}
.menu-btn:active{transform:scale(.95);box-shadow:0 2px 10px rgba(0,0,0,.3)}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ GAME UI â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#gameUI{position:absolute;inset:0;display:none}
#scoreBar{
    position:absolute;inset:0 auto auto 0;height:8%;background:rgba(0,0,0,.7);
    display:flex;justify-content:space-between;align-items:center;padding:0 15px;
    color:#fff;font-size:.9rem;font-weight:bold;z-index:10;
}
#comboDisplay{color:#FFD700;font-size:.8rem;text-shadow:2px 2px 4px rgba(0,0,0,.8)}
#pauseBtn{
    position:absolute;top:calc(8% + 10px);left:15px;width:40px;height:40px;
    background:rgba(0,0,0,.7);border:none;border-radius:50%;color:#fff;font-size:1rem;cursor:pointer;z-index:100;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ CANVAS FRAME â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#gameCanvas{
    position:absolute;top:8%;left:50%;transform:translateX(-50%);
    width:300px;height:400px;border:4px solid #8B4513;border-radius:12px;
    background:
        radial-gradient(circle at 30% 70%,rgba(173,216,230,.4) 0%,transparent 60%),
        radial-gradient(circle at 70% 30%,rgba(135,206,235,.3) 0%,transparent 50%),
        linear-gradient(180deg,rgba(173,216,230,.6) 0%,rgba(100,149,237,.7) 50%,rgba(65,105,225,.8) 100%);
    box-shadow:
        inset 0 0 30px rgba(0,100,150,.4),
        0 8px 32px rgba(0,0,0,.3),
        0 4px 16px rgba(0,0,0,.2);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ WATERLINE (DANGER) â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#waterline{
    position:absolute;left:50%;transform:translateX(-50%);
    width:300px;height:4px;border-radius:2px;bottom:calc(8% + 80px);z-index:5;opacity:.9;
    background:linear-gradient(90deg,#FF4444,#FF6B6B,#FF8888,#FF6B6B,#FF4444);
    animation:dangerPulse 1.5s ease-in-out infinite;
    box-shadow:0 0 15px rgba(255,68,68,.6);
}
@keyframes dangerPulse{
    0%,100%{opacity:.7;transform:translateX(-50%) scaleY(1);box-shadow:0 0 15px rgba(255,68,68,.4)}
    50%{opacity:1;transform:translateX(-50%) scaleY(1.2);box-shadow:0 0 25px rgba(255,68,68,.8)}
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ NEXT FRUIT BADGE â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#nextFruit{
    font-size:1.2rem;padding:8px 12px;border-radius:50%;
    background:linear-gradient(145deg,rgba(255,255,255,.9),rgba(220,220,220,.8));
    border:3px solid rgba(255,255,255,.6);
    box-shadow:0 4px 12px rgba(0,0,0,.2),inset 0 2px 4px rgba(255,255,255,.3);
    backdrop-filter:blur(10px);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ DANGER POPUP â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.danger-warning{
    position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
    background:linear-gradient(145deg,#FF4444,#CC0000);color:#fff;padding:20px 25px;border-radius:20px;
    font-size:1.3rem;font-weight:bold;display:none;z-index:500;
    animation:dangerAlert .6s ease-in-out infinite;
    box-shadow:0 8px 25px rgba(255,0,0,.4),inset 0 2px 4px rgba(255,255,255,.2);
    border:3px solid rgba(255,255,255,.3);text-shadow:2px 2px 4px rgba(0,0,0,.8);
}
@keyframes dangerAlert{
    0%,100%{background:linear-gradient(145deg,#FF4444,#CC0000);transform:translate(-50%,-50%) scale(1);}
    50%{background:linear-gradient(145deg,#FF6666,#FF0000);transform:translate(-50%,-50%) scale(1.05);}
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ OCTOPUS & SPEECH â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.octopus{position:absolute;left:10px;top:60%;font-size:3rem;animation:octopusFloat 4s ease-in-out infinite;z-index:1}
@keyframes octopusFloat{0%,100%{transform:translateY(0) rotate(-2deg)}50%{transform:translateY(-15px) rotate(2deg)}}
.speech-bubble{
    position:absolute;left:70px;top:50%;padding:8px 12px;border-radius:15px;max-width:100px;
    background:rgba(255,255,255,.95);color:#333;font-weight:bold;font-size:.8rem;opacity:0;transform:scale(0);
    transition:.3s;z-index:10;
}
.speech-bubble::after{
    content:'';position:absolute;left:-8px;top:50%;transform:translateY(-50%);
    border:8px solid transparent;border-right-color:rgba(255,255,255,.95);
}
.speech-bubble.show{opacity:1;transform:scale(1)}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ MODALS (instructions / game-over) â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#gameOverModal,#instructions{
    position:fixed;inset:0;display:none;justify-content:center;align-items:center;
    background:rgba(0,0,0,.8);z-index:2000;
}
.modal-content{
    background:linear-gradient(45deg,#20B2AA,#4682B4);padding:30px;border-radius:20px;
    text-align:center;color:#fff;box-shadow:0 10px 30px rgba(0,0,0,.5);
    max-width:90%;max-height:80%;overflow-y:auto;
}
.modal-content h2{margin-bottom:20px;font-size:1.8rem;color:#FFD700}
.modal-content p{margin:10px 0;line-height:1.5;text-align:left}
</style>
</head>

<body>
<div id="gameContainer">
    <!-- â”€â”€â”€â”€â”€â”€â”€ Menu â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="menu">
        <div id="title">ğŸ™ UNDERWATERMELON ğŸ‰</div>
        <button class="menu-btn" onclick="startGame()">ğŸ® PLAY</button>
        <button class="menu-btn" onclick="showInstructions()">â“ HOW TO PLAY</button>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€ Instructions â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="instructions">
        <div class="modal-content">
            <h2>ğŸ‰ HOW TO PLAY ğŸ‰</h2>
            <p>ğŸ¯ <strong>Goal:</strong> Merge identical fruits to create bigger ones!</p>
            <p>ğŸ“± <strong>Controls:</strong> Tap anywhere on the screen to drop fruits</p>
            <p>ğŸ”„ <strong>Merging:</strong> When two identical fruits touch, they combine into the next fruit</p>
            <p>ğŸ“ˆ <strong>Scoring:</strong> Bigger fruits = more points! Chain merges for combo bonuses</p>
            <p>âš ï¸ <strong>Danger Zone:</strong> Donâ€™t let fruits overflow the red line!</p>
            <p>ğŸ† <strong>Fruit Chain:</strong><br>
               ğŸ’ â†’ ğŸ“ â†’ ğŸ‡ â†’ ğŸŠ â†’ ğŸ â†’ ğŸ â†’ ğŸ‘ â†’ ğŸ â†’ ğŸˆ â†’ ğŸ‰</p>
            <button class="menu-btn" onclick="hideInstructions()">Got it!</button>
        </div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€ Game UI â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="gameUI">
        <button id="pauseBtn" onclick="togglePause()">â¸ï¸</button>

        <div id="scoreBar">
            <div id="score">Score: 0</div>
            <div id="comboDisplay"></div>
            <div id="nextFruit">ğŸ’</div>
        </div>

        <canvas id="gameCanvas" width="300" height="400"></canvas>
        <div id="waterline"></div>

        <div class="octopus">ğŸ™</div>
        <div class="speech-bubble" id="speechBubble"></div>
        <div class="danger-warning" id="dangerWarning">âš ï¸ DANGER ZONE! âš ï¸</div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€ Game Over â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="gameOverModal">
        <div class="modal-content">
            <h2>Game Over!</h2>
            <div id="finalScore"></div>
            <div id="finalStats"></div>
            <button class="menu-btn" onclick="restartGame()">ğŸ”„ RETRY</button>
            <button class="menu-btn" onclick="backToMenu()">ğŸ  MENU</button>
        </div>
    </div>
</div>

<script>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ GAME VARIABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let canvas,ctx,gameState='menu',score=0,combo=0,comboMultiplier=1,maxCombo=0,watermelonCount=0,
    fruits=[],currentFruit=null,nextFruitType=0,dropX=150,dangerTimer=0,paused=false,
    gatePoints=0,currentGate=1,gateThreshold=20,comboDecayTimer=0;

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ FRUIT DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const fruitTypes=[
    {emoji:'ğŸ“',color:'#FF69B4',size:20,points:1},
    {emoji:'ğŸŸ£',color:'#8A2BE2',size:26,points:3},
    {emoji:'ğŸ‹',color:'#FFD700',size:32,points:6},
    {emoji:'ğŸŠ',color:'#FF8C00',size:40,points:10},
    {emoji:'ğŸ',color:'#FF0000',size:50,points:15},
    {emoji:'ğŸ',color:'#9ACD32',size:62,points:21},
    {emoji:'ğŸ‘',color:'#FFB6C1',size:76,points:28},
    {emoji:'ğŸ¥¥',color:'#8B4513',size:92,points:36},
    {emoji:'ğŸ',color:'#FFD700',size:110,points:45},
    {emoji:'ğŸˆ',color:'#98FB98',size:130,points:55},
    {emoji:'ğŸ‰',color:'#00FF7F',size:152,points:66}
];
const shinyFruitTypes=fruitTypes.map(f=>({...f,emoji:'âœ¨'+f.emoji,glow:true}));
const encouragements=['Juicy!','TIDY!','Splash!','Wow!','Amazing!','Fantastic!'];

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
window.addEventListener('load',initGame);
function initGame(){
    canvas=document.getElementById('gameCanvas');if(!canvas)return;
    ctx=canvas.getContext('2d');

    /* Touch */
    canvas.addEventListener('touchstart',e=>{e.preventDefault();handleTouch(e)},{passive:false});
    canvas.addEventListener('touchmove',e=>{e.preventDefault();handleTouch(e)},{passive:false});
    canvas.addEventListener('touchend',e=>{e.preventDefault();dropFruit()},{passive:false});

    /* Mouse */
    canvas.addEventListener('click',handleClick);
    canvas.addEventListener('mousemove',handleMouseMove);

    generateNextFruit();
    requestAnimationFrame(gameLoop);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ INPUT HANDLERS â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function handleTouch(e){
    const r=canvas.getBoundingClientRect(),x=(e.touches[0].clientX-r.left)*(canvas.width/r.width);
    dropX=Math.max(20,Math.min(canvas.width-20,x));
}
const handleTouchMove=handleTouch;
function handleClick(e){
    if(gameState!=='playing'||paused)return;
    const r=canvas.getBoundingClientRect(),x=(e.clientX-r.left)*(canvas.width/r.width);
    dropX=Math.max(20,Math.min(canvas.width-20,x));dropFruit();
}
function handleMouseMove(e){
    if(gameState!=='playing'||paused)return;
    const r=canvas.getBoundingClientRect(),x=(e.clientX-r.left)*(canvas.width/r.width);
    dropX=Math.max(20,Math.min(canvas.width-20,x));
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ GAME LOOP â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function gameLoop(){
    if(gameState==='playing'){updatePhysics();render();updateUI()}
    requestAnimationFrame(gameLoop);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ FRUIT DROPPING â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function generateNextFruit(){
    nextFruitType=Math.floor(Math.random()*5);
    document.getElementById('nextFruit').textContent=fruitTypes[nextFruitType].emoji;
}
function dropFruit(){
    if(currentFruit||paused||gameState!=='playing')return;
    const t=fruitTypes[nextFruitType];
    currentFruit={x:dropX,y:canvas.height-30,vx:(Math.random()-.5)*2,vy:-8,
                  type:nextFruitType,shiny:false,size:t.size,color:t.color,emoji:t.emoji,glow:false};
    generateNextFruit();
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ PHYSICS â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function updatePhysics(){
    if(paused||gameState!=='playing')return;
    const G=-4,DRAG=1.3;

    /* Active fruit */
    if(currentFruit){
        applyBuoyancyDrag(currentFruit,G,DRAG,.1,.01);
        currentFruit.y+=currentFruit.vy;currentFruit.x+=currentFruit.vx;

        if(currentFruit.y-currentFruit.size/2<=5){
            currentFruit.y=5+currentFruit.size/2;currentFruit.vy*=-.08;
            if(Math.abs(currentFruit.vy)<.5){fruits.push(currentFruit);currentFruit=null;}
        }
        wallCollide(currentFruit,.3);
    }

    /* Settled fruits */
    fruits.forEach(f=>{applyBuoyancyDrag(f,G,DRAG*.8,.008,.08*Math.pow(f.size/20,.5));wallCollide(f,.4);f.vx*=.96;f.vy*=.97});

    checkCollisions();checkMerges();checkDangerZone();
}
function applyBuoyancyDrag(f,G,DRAG,buoyScale,dragScale){
    f.vy+=G*buoyScale;
    const s=Math.hypot(f.vx,f.vy);if(s){
        const drag=DRAG*s*s*dragScale;f.vx-=(f.vx/s)*drag;f.vy-=(f.vy/s)*drag;
    }
}
function wallCollide(f,rest){
    if(f.x-f.size/2<=0){f.x=f.size/2;f.vx*=-rest}
    if(f.x+f.size/2>=canvas.width){f.x=canvas.width-f.size/2;f.vx*=-rest}
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ COLLISIONS / MERGE â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function checkCollisions(){
    for(let i=0;i<fruits.length;i++){
        for(let j=i+1;j<fruits.length;j++){
            const a=fruits[i],b=fruits[j],
                  dx=b.x-a.x,dy=b.y-a.y,dist=Math.hypot(dx,dy),
                  min=(a.size+b.size)/2;
            if(dist<min&&dist>0){
                const over=min-dist,moveX=(dx/dist)*over*.5,moveY=(dy/dist)*over*.5;
                a.x-=moveX;a.y-=moveY;b.x+=moveX;b.y+=moveY;
            }
        }
    }
}
function checkMerges(){
    for(let i=fruits.length-1;i>=0;i--)for(let j=i-1;j>=0;j--){
        const a=fruits[i],b=fruits[j],
              dist=Math.hypot(b.x-a.x,b.y-a.y),
              mergeDist=(a.size+b.size)/2.5;
        if(dist<mergeDist&&canMerge(a,b)){performMerge(a,b,i,j);return;}
    }
    comboDecayTimer+=1/60;if(comboDecayTimer>3&&comboMultiplier>1){
        comboMultiplier=Math.max(1,comboMultiplier-.5);comboDecayTimer=0;
    }
}
function canMerge(a,b){
    if(a.type===b.type&&a.shiny===b.shiny)return true;
    if(a.type===10&&b.type===10)return true;
    return false;
}
function performMerge(a,b,i,j){
    const midX=(a.x+b.x)/2,midY=(a.y+b.y)/2;
    fruits.splice(i,1);fruits.splice(j,1);
    let newF=null,pts=0;

    if(a.type===10&&b.type===10){
        if(a.shiny||b.shiny){
            pts=shinyFruitTypes[10].points; /* both shiny OR mixed: board clear */
        }else{
            newF=createFruit(midX,midY,0,true,-4);pts=fruitTypes[0].points;
        }
    }else{
        const next=a.type+1,isShiny=a.shiny;
        if(next<fruitTypes.length){
            newF=createFruit(midX,midY,next,isShiny,-4);
            pts=isShiny?shinyFruitTypes[next].points:fruitTypes[next].points;
        }
    }

    const earned=Math.floor(pts*comboMultiplier);score+=earned;gatePoints+=pts;
    comboMultiplier=Math.min(7.5,comboMultiplier+.5);combo++;maxCombo=Math.max(maxCombo,combo);comboDecayTimer=0;
    checkGateProgress();
    if(comboMultiplier>2)showSpeechBubble(encouragements[Math.floor(Math.random()*encouragements.length)]);
    updateUI();
}
function createFruit(x,y,type,shiny=false,vy=-4){
    const d=shiny?shinyFruitTypes[type]:fruitTypes[type],
          f={x,y,vx:(Math.random()-.5)*2,vy,size:d.size,color:d.color,emoji:d.emoji,type,shiny,glow:d.glow||false};
    fruits.push(f);if(type===10)watermelonCount++;return f;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ GATES / DANGER â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function checkGateProgress(){if(gatePoints>=gateThreshold)openGate();}
function openGate(){
    fruits.forEach(f=>{f.y-=100;f.vy-=2});currentGate++;gatePoints=0;gateThreshold+=15;showSpeechBubble('GATE OPENED!');
}
function checkDangerZone(){
    const limit=canvas.height-80;let danger=false;
    fruits.forEach(f=>{if(f.y+f.size/2>=limit)danger=true});
    if(currentFruit&&currentFruit.y+currentFruit.size/2>=limit)danger=true;
    if(danger){dangerTimer+=1/60;document.getElementById('dangerWarning').style.display='block';
        if(dangerTimer>=3)gameOver();
    }else{dangerTimer=0;document.getElementById('dangerWarning').style.display='none'}
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function render(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    /* background gradient inside canvas */
    const g=ctx.createLinearGradient(0,0,0,canvas.height);
    g.addColorStop(0,'rgba(173,216,230,.3)');g.addColorStop(1,'rgba(100,149,237,.5)');
    ctx.fillStyle=g;ctx.fillRect(0,0,canvas.width,canvas.height);

    /* launch ring */
    ctx.strokeStyle='rgba(255,215,0,.8)';ctx.lineWidth=3;ctx.beginPath();
    ctx.arc(dropX,canvas.height-25,30,0,Math.PI*2);ctx.stroke();
    ctx.strokeStyle='rgba(255,215,0,.4)';ctx.lineWidth=6;ctx.beginPath();
    ctx.arc(dropX,canvas.height-25,35,0,Math.PI*2);ctx.stroke();

    /* preview */
    if(!currentFruit&&!paused&&gameState==='playing'){
        const p=fruitTypes[nextFruitType];ctx.save();ctx.globalAlpha=.8;ctx.fillStyle=p.color;
        ctx.beginPath();ctx.arc(dropX,canvas.height-25,p.size/2,0,Math.PI*2);ctx.fill();
        ctx.globalAlpha=1;ctx.font=`${p.size*.5}px Arial`;ctx.textAlign='center';ctx.textBaseline='middle';
        ctx.fillText(p.emoji,dropX,canvas.height-25);ctx.restore();
    }

    /* fruits */
    if(currentFruit)drawFruit(currentFruit);fruits.forEach(drawFruit);
    drawBubbles();
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ FRUIT DRAWING WITH DEPTH â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function drawFruit(f){
    ctx.save();

    /* soft shadow */
    ctx.fillStyle='rgba(0,0,0,.3)';
    ctx.beginPath();ctx.arc(f.x+3,f.y+4,f.size/2,0,Math.PI*2);ctx.fill();

    /* glow for shiny */
    if(f.glow){
        const gg=ctx.createRadialGradient(f.x,f.y,f.size/6,f.x,f.y,f.size*.8);
        gg.addColorStop(0,'rgba(255,255,255,.8)');gg.addColorStop(.3,'rgba(255,255,255,.4)');
        gg.addColorStop(.7,'rgba(255,255,255,.1)');gg.addColorStop(1,'rgba(255,255,255,0)');
        ctx.fillStyle=gg;ctx.beginPath();ctx.arc(f.x,f.y,f.size*.8,0,Math.PI*2);ctx.fill();
    }

    /* body gradient */
    const bg=ctx.createRadialGradient(f.x,f.y,f.size/8,f.x,f.y,f.size/2);
    bg.addColorStop(0,f.color);bg.addColorStop(.7,f.color);bg.addColorStop(1,shadeColor(f.color,-20));
    ctx.fillStyle=bg;ctx.beginPath();ctx.arc(f.x,f.y,f.size/2,0,Math.PI*2);ctx.fill();

    /* glossy highlight */
    const hg=ctx.createRadialGradient(f.x-f.size/4,f.y-f.size/4,0,f.x-f.size/6,f.y-f.size/6,f.size/3);
    hg.addColorStop(0,'rgba(255,255,255,.6)');hg.addColorStop(.5,'rgba(255,255,255,.2)');hg.addColorStop(1,'transparent');
    ctx.fillStyle=hg;ctx.beginPath();ctx.arc(f.x,f.y,f.size/2,0,Math.PI*2);ctx.fill();

    /* emoji */
    ctx.font=`${f.size*.35}px Arial`;ctx.textAlign='center';ctx.textBaseline='middle';
    ctx.fillStyle='rgba(0,0,0,.8)';ctx.fillText(f.emoji,f.x+1,f.y+1);
    ctx.fillStyle='#fff';ctx.fillText(f.emoji,f.x,f.y);

    ctx.restore();
}
function shadeColor(col,percent){
    const num=parseInt(col.slice(1),16),amt=Math.round(2.55*percent),
          R=(num>>16)+amt,G=(num>>8&0x00FF)+amt,B=(num&0x0000FF)+amt;
    return '#'+(0x1000000+(R<255?R<1?0:R:255)*0x10000+(G<255?G<1?0:G:255)*0x100+(B<255?B<1?0:B:255)).toString(16).slice(1);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ SIMPLE BUBBLES â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function drawBubbles(){
    const t=Date.now()*0.001;ctx.fillStyle='rgba(255,255,255,.4)';
    for(let i=0;i<3;i++){
        const x=Math.sin(t*.5+i*2)*40+canvas.width/2,y=canvas.height-((t*20+i*80)%canvas.height),
              s=2+Math.sin(t+i)*1;
        ctx.beginPath();ctx.arc(x,y,s,0,Math.PI*2);ctx.fill();
    }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ UI / STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function updateUI(){
    document.getElementById('score').textContent=`Score: ${score.toLocaleString()}`;
    const cd=document.getElementById('comboDisplay');
    if(comboMultiplier>1){
        cd.textContent=`x${comboMultiplier.toFixed(1)} JUICY!`;
        cd.style.color=comboMultiplier>5?'#FF69B4':'#00FFFF';
    }else{
        cd.textContent=`Gate ${currentGate}: ${gatePoints}/${gateThreshold}`;
        cd.style.color='#fff';
    }
}
function showSpeechBubble(txt){
    const b=document.getElementById('speechBubble');b.textContent=txt;b.classList.add('show');
    setTimeout(()=>b.classList.remove('show'),2000);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ MENU / PAUSE / GAME OVER â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function startGame(){
    document.getElementById('menu').style.display='none';
    document.getElementById('gameUI').style.display='block';
    gameState='playing';resetGame();
}
function resetGame(){
    score=combo=0;comboMultiplier=1;maxCombo=watermelonCount=0;fruits.length=0;currentFruit=null;
    dangerTimer=0;paused=false;gatePoints=0;currentGate=1;gateThreshold=20;comboDecayTimer=0;
    generateNextFruit();updateUI();
}
function togglePause(){paused=!paused;document.getElementById('pauseBtn').textContent=paused?'â–¶ï¸':'â¸ï¸'}
function gameOver(){
    gameState='gameOver';
    document.getElementById('finalScore').textContent=`Final Score: ${score.toLocaleString()}`;
    document.getElementById('finalStats').innerHTML=`<p>Highest Combo: x${maxCombo}</p><p>Watermelons Created: ${watermelonCount}</p>`;
    document.getElementById('gameOverModal').style.display='flex';
}
function restartGame(){document.getElementById('gameOverModal').style.display='none';gameState='playing';resetGame();}
function backToMenu(){
    document.getElementById('gameOverModal').style.display='none';
    document.getElementById('gameUI').style.display='none';
    document.getElementById('menu').style.display='flex';gameState='menu';
}
function showInstructions(){document.getElementById('instructions').style.display='flex'}
function hideInstructions(){document.getElementById('instructions').style.display='none'}
</script>
</body>
</html>